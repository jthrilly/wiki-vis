function signum(o){return 0>o?-1:1}function absolute(o){return 0>o?-o:o}function drawPath(o,e,i,n,t,s){var r=parseFloat(e.attr("stroke-width"));o.attr("height")<s&&o.attr("height",s),o.attr("width")<i+r&&o.attr("width",i+r),o.attr("width")<t+r&&o.attr("width",t+r);var l=.15*(t-i),a=.15*(s-n),d=a<absolute(l)?a:absolute(l),c=0,g=1;i>t&&(c=1,g=0),e.attr("x1",i),e.attr("y1",n),e.attr("x2",t),e.attr("y2",s)}function connectElements(o,e,i,n){var t=$("#simple-map");if(i.offset().top>n.offset().top){var s=i;i=n,n=s}var r=t.offset().top,l=t.offset().left,a=i.offset(),d=n.offset(),c=a.left+.5*i.outerWidth()-l,g=a.top+.5*i.outerHeight()-r,h=d.left+.5*n.outerWidth()-l,f=d.top+.5*i.outerHeight()-r;drawPath(o,e,c,g,h,f)}Object.defineProperty(Array.prototype,"remove",{enumerable:!1,value:function(o){for(var e=0,i=0;i<this.length;i++)this[i]===o&&(this.splice(i,1),e++,i--);return e}});var wikiVis=function(o){function e(){var o=(180*Math.random()).toFixed(3),e=Math.floor(Math.random());0==e&&(o=-1*o);var i=(90*Math.random()).toFixed(3),e=Math.floor(Math.random());return 0==e&&(i=-1*i),new L.LatLng(o,i)}var n={simple:!1,elem:"map",mapHeight:"500px",mapWidth:"100%",data:""},t=this,s={},r=o||n,l={},a=$("#"+r.elem),d={blue:"#0000ff",gold:"#C99A2E"};return t.generateRandomChain=function(){console.log("generating json....");var o={},n=3,t=10;o.chainID=Math.floor(1e5*Math.random()),o.issuesMap=["Working Conditions","Human Rights","Environmental Damage","Conflict","Animal welfare","Child labour","Forced Labour ","Tax Avoidance","Other"],o.chainURL="http://wikichains.oii.ox.ac.uk/chains/"+o.chainID,o.chainName="Chain Example",o.children=[],o.edges=[];var s=Math.floor(10*Math.random())+1;for(console.log("Creating "+s+" nodes."),i=0;s>i;i++){var r={};r.id=Math.floor(1e5*Math.random()),r.title="Article "+r.id,r.type=Math.floor(6*Math.random()),r.url="http://wikichains.oii.ox.ac.uk/article/"+r.id,r.coordinates=e(),o.children.push(r)}for(console.log("Generating issues..."),$.each(o.children,function(e,n){n.issues=[];var t=Math.floor(9*Math.random());for(console.log("Child "+e+" will have "+t+" issues."),i=0;t>i;i++)o:for(;;){if(thisIssue=Math.floor(Math.random()*o.issuesMap.length),-1==n.issues.indexOf(thisIssue)){n.issues.push(thisIssue);var s=i+1;console.log("Issue "+s+" is "+thisIssue);break o}console.log(thisIssue+" already added.")}}),console.log("generating edges..."),i=0;i<o.children.length-1;i++){var l={};l.from=i,l.to=i+1,console.log("adding edge:"),console.log(l),o.edges.push(l)}return console.log("Finished generating chain."),console.log(o),JSON.stringify(o)},t.addPoint=function(o){console.log(o);var e=o.coordinates,i={};i.issues=o.issues;var n=new L.RadialChainMarker(e,i).addTo(l),n=new L.Marker(e,{radius:5,zIndexOffset:1e3}).addTo(l)},t.addEdge=function(o,e){console.log("adding edge.");var i=l.getBounds(),n=i.getSouthWest(),t=i.getNorthEast(),s=t.lng-n.lng,r=t.lat-n.lat,a=[o,e],c={color:d.gold,weight:4};console.log(a);var g=new L.ArcedPolyline(a,c).addTo(l);console.log(g)},t.init=function(){if(r.simple){var o=[0,0,0,0,0,0],e=[],n=[],d=0,c=new Array;$.each(s.children,function(o,e){n.push(e.id)});var g=n;console.log("setting base IDs to node IDs:"),console.log(g),$.each(s.edges,function(o,e){console.log(e),console.log("removing node:"+s.children[e.to].id),g.remove(s.children[e.to].id),console.log(g)});var h=g,f=0,u=!0,m=0;for(console.log("currentNodes:"),console.log(h);u;){console.log("Starting unfinished loop.");var v=[];h.length>0?($.each(h,function(o,e){if(console.log("I have "+h.length+" nodes to iterate over. Numer "+o),console.log("Current node is: "+e),console.log("current row is "+f),console.log("frame is: "+m),c[f]instanceof Array);else{c[f]=new Array;for(var i=0;i<s.children.length;i++)c[f].push(0)}c[f][m]instanceof Array||(c[f][m]=new Array),c[f][m].push({id:e,mask:new Array(0,0,0,0,0,0)});var n=c[f][m].length-1;v=[],$.each(s.edges,function(o,i){if(console.log("nodeValue: "+e+" edge from: "+s.children[i.from].id+" edge to: "+s.children[i.to].id),s.children[i.from].id==e)v.push(s.children[i.to].id),console.log("Found edge from this node to another. Adding to next current nodes:"+s.children[i.to].id),console.log(v);else if(s.children[i.to].id==e){var n=0;console.log("finding row of linking node.");for(var t=0;t<c.length;t++){console.log("iterating over rows. Row number: "+t+" of "+c.length),console.log("length of this row is "+c[t].length);for(var r=0;r<c[t].length;r++)if(console.log(c[t][r][0]),void 0!==c[t][r][0]&&c[t][r][0].id==s.children[i.from].id){console.log("looking within row. Im looking for the value "+s.children[i.from].id+" to match "+c[t][r][0].id),n=t,console.log("prev row found: "+n);break}}console.log("Found edge linking to this node. Node origin of edge is: "+s.children[i.from].id+". Its row is: "+n),0==n?0==f?(console.log("// same row so left 001000"),c[f][m][0].mask[2]=1,console.log("// linking node gets right 000100"),c[n][m-1][0].mask[3]=1):1==f&&(console.log("// above us so top left 100000"),c[f][m][0].mask[0]=1,console.log("// linking node gets bottom right 000001"),c[n][m-1][0].mask[5]=1):1==n&&(0==f?(console.log("// below us so bottom left 000010"),c[f][m][0].mask[4]=1,console.log("// linking node gets top right 010000"),c[n][m-1][0].mask[1]=1):1==f&&(console.log("// same row so left 001000"),c[f][m][0].mask[2]=1,console.log("// linking node gets right 000100"),c[n][m-1][0].mask[3]=1)),console.log("Row masks have been modified. Row is now:"),console.log(c)}}),f++}),h=v,console.log("resetting current Row"),f=0,m++):(console.log("current nodes = 0. finishing loop"),u=!1)}$.each(c,function(o,e){console.log("iterating rows. row no: "+o),$(".row-container").append('<div class="row"></div>');var i=$(".grid").outerHeight()*$(".row").length;$("#svg1").css({height:i});var n=-1*i;$(".row").css({top:n}),$.each(c[o],function(o,e){var i=$(".row:last").outerWidth()+$(".grid").outerWidth();if($(".row:last").css({width:i}),$("#svg1").outerWidth()<i&&$("#svg1").css({width:i}),console.log(e),0!=e){console.log(e);var n="img/simple-bgs/"+e[0].mask.join("")+".png";$(".row:last").append('<div class="grid"><div class="circle" id="'+e[0].id+'"></div><div class="article-text">'+e[0].id+"</div></div>")}else $(".row:last").append('<div class="grid"></div>')})}),$.each(s.edges,function(o,e){var i=document.createElementNS("http://www.w3.org/2000/svg","line"),n=$(i).attr({strokeWidth:4,stroke:"red"});$("#svg1").append(n);var t=s.children[e.from].id,r=s.children[e.to].id;console.log(t),connectElements($("#svg1"),$(i),$("#"+t),$("#"+r))})}else{L.Icon.Default.imagePath="components/leaflet/dist/images",$(a).width("100%").height("500px");var p=new L.StamenTileLayer("toner-lite");l=L.map(r.elem,{zoom:3,center:[51.505,-.09]}),l.addLayer(p),L.RadialChainMarker=L.ChartMarker.extend({initialize:function(o,e){L.Util.setOptions(this,e),console.log("passed: "+e),console.log(this),L.ChartMarker.prototype.initialize.call(this,o,e)},options:{weight:1,opacity:1,color:"#000",fill:!1,radius:45,rotation:360,numSegments:9,offset:0,barThickness:20,maxDegrees:360,iconSize:new L.Point(50,40),backgroundStyle:{fill:!0,fillColor:"#707070",fillOpacity:1,opacity:1,color:"#505050"},colors:L.ColorBrewer.Qualitative.Set1[9]},_loadComponents:function(){var o,e,n,t=0,s=0,r=this.options.maxDegrees||360,l=this.options.radiusX||this.options.radius,a=this.options.radiusY||this.options.radius,d=this.options.issues;console.log("data = "+d);var c=this.options.barThickness||4,g=this.options.colors;for(i=0;9>i;i++){console.log("iterating through each segment. i = "+i),o=i+1,console.log("value = "+o);var h=360/this.options.numSegments*i;console.log("angle is: "+h);var f=360/this.options.numSegments*(i+1);console.log("end angle is: "+f);var u={};u.startAngle=h,u.endAngle=f,-1!=d.indexOf(i)?(console.log(i+" is in "+d),u.fillColor=g[i]):(console.log("no issue in this segment."),u.fillColor="rgba(0,0,0,0)"),u.opacity=1,u.fillOpacity=1,u.weight=1,u.color="rgba(0,0,0,0)",u.fill=!0,u.offset=2,u.radiusX=40,u.radiusY=40,u.barThickness=23,u.rotation=0,u.key=i,u.dropShadow=!1,u.gradient=!1,u.value=o,console.log(u),bar=new L.RadialBarMarker(this._latlng,u),console.log(bar),this.addLayer(bar)}}}),$.each(s.children,function(o,e){t.addPoint(e)}),$.each(s.edges,function(o,e){var i=s.children[e.from].coordinates,n=s.children[e.to].coordinates;t.addEdge(i,n)})}},$.getJSON("http://localhost/joshua/wiki-vis/sample.json").done(function(o){s=o,t.init()}).fail(function(){console.log("error getting data.")}),t};
//# sourceMappingURL=./main.min.map